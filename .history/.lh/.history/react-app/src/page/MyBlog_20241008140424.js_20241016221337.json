{
    "sourceFile": ".history/react-app/src/page/MyBlog_20241008140424.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1729091488937,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1729091488937,
            "name": "Commit-0",
            "content": "import axios from \"axios\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { useAuth } from \"../AuthProvider\";\r\nimport { Link, useNavigate } from \"react-router-dom\";\r\n\r\n\r\nfunction MyBlog() {\r\n    const { user } = useAuth();\r\n    const [blogs, setBlogs] = useState([]);\r\n    const navigate = useNavigate();\r\n    const getBlogs = () => {\r\n        axios.get(\"http://localhost:4000/read-post\", {\r\n            headers: {\r\n                Authorization: `Bearer ${user.token}`\r\n            }\r\n        }).then(res => {\r\n            console.log(\"Blogs updated: \", res.data); // ตรวจสอบข้อมูลที่ถูกดึงมาว่าอัปเดตหรือไม่\r\n            setBlogs(res.data);\r\n        }).catch(error => {\r\n            console.log(error);\r\n        });\r\n    };\r\n\r\n    useEffect(() => {\r\n        console.log(\"Component mounted, fetching blogs...\");\r\n        getBlogs();\r\n    }, []);\r\n\r\n    // ฟังก์ชันสำหรับการลบบล็อก\r\n    const handleDelete = (blogid) => {\r\n        if (window.confirm(\"คุณต้องการลบโพสนี้หรือไม่?\")) {\r\n            axios.delete(`http://localhost:4000/post/${blogid}`)\r\n                .then((res) => {\r\n                     alert(\"ลบโพสสำเร็จ\");\r\n                    getBlogs(); // เรียกข้อมูลใหม่หลังจากลบเสร็จ\r\n                })\r\n                .catch((error) => {\r\n                    console.error(\"Error deleting post: \", error); // ตรวจสอบ error หากการลบมีปัญหา\r\n                    alert(\"เกิดข้อผิดพลาดในการลบโพส\");\r\n                });\r\n        }\r\n    };\r\n    const handleEdit = (blogid) => {\r\n        navigate(`/edit-post/${blogid}`);\r\n    };\r\n    const listBlog = blogs.map((blog) => (\r\n        <tr key={blog.blogid} className=\"hover:bg-gray-100\">\r\n            <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">{blog.blogid}</td>\r\n            <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">{blog.title}</td>\r\n            <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">{blog.category}</td>\r\n            <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">{new Date(blog.update_at).toLocaleString()}</td>\r\n            <td className=\"px-6 py-4 whitespace-nowrap text-sm text-blue-500\">\r\n            <button\r\n                    onClick={() => handleEdit(blog.blogid)}\r\n                    className=\"text-indigo-600 hover:text-indigo-900 mr-4\"\r\n                >\r\n                    แก้ไข\r\n                </button>\r\n                <button\r\n                    onClick={() => handleDelete(blog.blogid)}\r\n                    className=\"text-red-600 hover:text-red-900\"\r\n                >\r\n                    ลบ\r\n                </button>\r\n            </td>\r\n        </tr>\r\n    ));\r\n\r\n\r\n    return (\r\n        <>\r\n            <div className=\"mx-auto p-4\">\r\n\r\n                <h2 className=\"text-2xl text-teal-700 mb-10 \">แสดงรายการโพสทั้งหมด</h2>\r\n                <div className=\"flex justify-end mb-4\">\r\n                    <Link to={'/new-post'}>\r\n                        <button className=\"p-2 bg-blue-500 hover:bg--400 text-white rounded\">สร้างใหม่</button>\r\n                    </Link>\r\n                </div>\r\n                <div className=\"overflow-x-auto\">\r\n                    <table className=\"min-w-full divide-y divide-gray-200\">\r\n                        <thead className=\"bg-gray-50\">\r\n                            <tr>\r\n                                <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">ID</th>\r\n                                <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">ชื่อเรื่อง</th>\r\n                                <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">หมวดหมู่</th>\r\n                                <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">อัพเดทล่าสุด</th>\r\n                                <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">จัดการข้อมูล</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                            {listBlog}\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n            </div>\r\n        </>\r\n    );\r\n}\r\n\r\nexport default MyBlog;"
        }
    ]
}